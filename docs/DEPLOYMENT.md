# 部署架构

> 返回 [主架构文档](ARCHITECTURE.md)

---

## 目录

- [本地开发部署](#本地开发部署)
- [生产部署架构](#生产部署架构)

---

## 本地开发部署 `[✅ 当前方式]`

```
┌─────────────────────────────────────────────────────────────────┐
│                     本地开发环境                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  Host Machine                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Python Application (.venv)                             │   │
│  │  • main.py                                              │   │
│  │  • config.py                                            │   │
│  └─────────────────────────────────────────────────────────┘   │
│           │                                                     │
│           ▼                                                     │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Docker Compose                                         │   │
│  │  ┌─────────────────────┐  ┌─────────────────────┐      │   │
│  │  │ memory_graph_db     │  │ memory_vector_db    │      │   │
│  │  │ (Neo4j 5.26.0)      │  │ (Qdrant latest)     │      │   │
│  │  │                     │  │                     │      │   │
│  │  │ :7474 (Browser)     │  │ :6333 (API)         │      │   │
│  │  │ :17687 (Bolt)       │  │                     │      │   │
│  │  │                     │  │                     │      │   │
│  │  │ ./neo4j_data:/data  │  │ ./qdrant_data:      │      │   │
│  │  │                     │  │   /qdrant/storage   │      │   │
│  │  └─────────────────────┘  └─────────────────────┘      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  外部服务                                                        │
│  ┌─────────────────────┐  ┌─────────────────────┐              │
│  │ DeepSeek API        │  │ Google Gemini API   │              │
│  │ api.deepseek.com    │  │ (备选)              │              │
│  └─────────────────────┘  └─────────────────────┘              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 启动命令

```bash
# 启动数据库服务
docker-compose up -d

# 停止服务
docker-compose down

# 查看服务状态
docker-compose ps
```

### 数据持久化

| 服务 | 本地目录 | 容器目录 |
|------|----------|----------|
| Neo4j | `./neo4j_data` | `/data` |
| Qdrant | `./qdrant_data` | `/qdrant/storage` |

---

## 生产部署架构 `[📋 规划]`

```
┌─────────────────────────────────────────────────────────────────┐
│                     生产环境部署架构                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                    Load Balancer                        │   │
│  │                    (Nginx / Traefik)                    │   │
│  └─────────────────────────────┬───────────────────────────┘   │
│                                │                                │
│         ┌──────────────────────┼──────────────────────┐        │
│         ▼                      ▼                      ▼        │
│  ┌─────────────┐        ┌─────────────┐        ┌─────────────┐ │
│  │ API Server  │        │ API Server  │        │ API Server  │ │
│  │ (Replica 1) │        │ (Replica 2) │        │ (Replica N) │ │
│  └──────┬──────┘        └──────┬──────┘        └──────┬──────┘ │
│         │                      │                      │        │
│         └──────────────────────┼──────────────────────┘        │
│                                │                                │
│         ┌──────────────────────┼──────────────────────┐        │
│         ▼                      ▼                      ▼        │
│  ┌─────────────┐        ┌─────────────┐        ┌─────────────┐ │
│  │   Neo4j     │        │   Qdrant    │        │   Redis     │ │
│  │  (Primary)  │        │  (Cluster)  │        │  (Cache)    │ │
│  └─────────────┘        └─────────────┘        └─────────────┘ │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                  可观测性平台                             │   │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐           │   │
│  │  │Prometheus │  │  Jaeger   │  │   Loki    │           │   │
│  │  │ (Metrics) │  │ (Tracing) │  │ (Logging) │           │   │
│  │  └───────────┘  └───────────┘  └───────────┘           │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 生产环境组件

| 组件 | 用途 | 状态 |
|------|------|------|
| Load Balancer | 流量分发、SSL 终止 | 📋 规划 |
| API Server | 无状态应用服务 | 📋 规划 |
| Neo4j Primary | 图谱存储 | 📋 规划 |
| Qdrant Cluster | 向量存储集群 | 📋 规划 |
| Redis | 缓存层 | 📋 规划 |
| 可观测性平台 | 监控告警 | 📋 规划 |

### 扩展考虑

- **水平扩展**: API Server 无状态，可按需增加副本
- **数据库扩展**: Qdrant 支持分片，Neo4j 支持读副本
- **缓存策略**: Redis 缓存热点查询结果

---

## 相关文档

- [快速开始](GETTING_STARTED.md) - 本地环境搭建
- [配置参考](CONFIGURATION.md) - 详细配置选项
- [可观测性设计](OBSERVABILITY.md) - 监控告警设计
