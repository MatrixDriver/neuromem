# 技术决策记录 (ADR)

> 返回 [主架构文档](ARCHITECTURE.md)

本文档记录项目中的重要技术决策及其背景。

---

## 目录

- [ADR-001: 选择 Mem0 作为记忆框架](#adr-001-选择-mem0-作为记忆框架)
- [ADR-002: 选择 DeepSeek 作为默认 LLM](#adr-002-选择-deepseek-作为默认-llm)
- [ADR-003: 选择本地 HuggingFace 作为默认 Embedding](#adr-003-选择本地-huggingface-作为默认-embedding)
- [ADR-004: 简单 user_id 隔离而非完整租户系统](#adr-004-简单-user_id-隔离而非完整租户系统)
- [ADR-005: Python SDK 优先于 REST API 和 CLI](#adr-005-python-sdk-优先于-rest-api-和-cli)

---

## ADR-001: 选择 Mem0 作为记忆框架

**状态**: ✅ 已采纳
**日期**: 2025-01

### 背景

需要一个支持混合存储（向量 + 图谱）的记忆管理框架。

### 决策

选择 Mem0 框架，因为：
- 原生支持 graph_store 配置
- 自动实体关系提取
- 简洁的 API 设计
- 活跃的社区维护

### 后果

| 类型 | 影响 |
|------|------|
| 正面 | 快速实现混合记忆功能 |
| 负面 | 受限于 Mem0 的抽象层，部分底层优化受限 |

---

## ADR-002: 选择 DeepSeek 作为默认 LLM

**状态**: ✅ 已采纳
**日期**: 2025-01

### 背景

需要选择默认的 LLM 提供商。

### 决策

默认使用 DeepSeek，同时保留 Gemini 切换能力，因为：
- DeepSeek 性价比高
- 中文理解能力强
- OpenAI 兼容接口，便于切换

### 后果

| 类型 | 影响 |
|------|------|
| 正面 | 降低 API 成本 |
| 负面 | 需要维护两套 LLM 配置 |

---

## ADR-003: 选择本地 HuggingFace 作为默认 Embedding

**状态**: ✅ 已采纳
**日期**: 2025-01

### 背景

需要选择 Embedding 方案。

### 决策

默认使用本地 HuggingFace 模型 `paraphrase-multilingual-MiniLM-L12-v2`，因为：
- 无 API 调用成本
- 支持多语言
- 384 维向量足够日常使用

### 权衡

- 放弃了高维向量方案（如 OpenAI text-embedding-3-large 的 3072 维）
- 如需更高精度，可选择：
  - Gemini text-embedding-004 (768 维) - 云端 API
  - OpenAI text-embedding-3-large (3072 维) - 极致精度，API 成本较高

---

## ADR-004: 简单 user_id 隔离而非完整租户系统

**状态**: ✅ 已采纳
**日期**: 2025-01

### 背景

需要支持多用户数据隔离。

### 决策

采用简单的 user_id 参数隔离，而非完整的租户管理系统，因为：
- 降低系统复杂度
- 当前场景不需要认证/授权
- 可通过外部系统补充用户管理

### 后果

| 类型 | 影响 |
|------|------|
| 正面 | 简化实现 |
| 负面 | 不适用于真正的多租户 SaaS 场景 |

---

## ADR-005: Python SDK 优先于 REST API 和 CLI

**状态**: ❌ 已撤销（移除 Python SDK）
**日期**: 2025-01（采纳），2026-01（撤销）

### 背景

需要确定接入层的开发优先级。

### 原始决策

优先开发 Python SDK，然后是 REST API，最后是 CLI，因为：
- SDK 是最直接的集成方式
- 可以快速验证接口设计
- REST API 可基于 SDK 构建
- CLI 主要用于调试，优先级较低

### 撤销原因（2026-01）

决定移除 Python SDK，原因：
- Python SDK 只是对 `get_brain()` 的薄封装，没有额外业务价值
- REST API 已满足所有生产需求（DIFY 集成、普通用户）
- 简化接口，减少维护成本
- CLI 工具可直接使用 `get_brain()`，无需 SDK 封装

### 后果

| 类型 | 影响 |
|------|------|
| 正面 | 快速提供可用的编程接口 |
| 负面 | 延迟了 HTTP API 的可用性 |

---

## ADR 模板

新增 ADR 时请使用以下模板：

```markdown
## ADR-XXX: 标题

**状态**: 🔄 讨论中 / ✅ 已采纳 / ❌ 已废弃
**日期**: YYYY-MM

### 背景

描述决策的背景和上下文。

### 决策

描述做出的决策及原因。

### 后果

| 类型 | 影响 |
|------|------|
| 正面 | ... |
| 负面 | ... |
```

---

## 相关文档

- [主架构文档](ARCHITECTURE.md) - 系统整体设计
- [配置参考](CONFIGURATION.md) - 具体配置实现
